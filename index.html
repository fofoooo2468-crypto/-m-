
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>محلل المهام التنظيمية</title>
  <style>
    body { font-family: "Tahoma","Segoe UI",Arial,sans-serif; margin:24px; line-height:1.8; background:#fafafa; color:#222; }
    h2 { margin-top:0; }
    textarea { width:100%; max-width:900px; box-sizing:border-box; padding:12px; border:1px solid #ddd; border-radius:8px; background:#fff; font-size:15px; resize:vertical; }
    .actions { margin:12px 0 20px; display:flex; gap:10px; flex-wrap:wrap; }
    button { background:#0b5394; color:#fff; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; font-size:14px; }
    button.secondary { background:#777; }
    .result { max-width:900px; background:#fff; border:1px solid #eee; border-radius:10px; padding:16px; min-height:60px; white-space:pre-wrap; word-break:break-word; }
    .verb{color:#0b5394;font-weight:bold;} .domain{color:#38761d;font-weight:bold;} .tool{color:#7f6000;font-weight:bold;} .output{color:#990000;font-weight:bold;}
  </style>
</head>
<body>

  <h2>محلل صياغة المهام التنظيمية</h2>

  <label for="taskInput" style="display:block;margin-bottom:6px;">
    أدخل مهمة أو أكثر (كل مهمة في سطر مستقل):
  </label>
  <textarea id="taskInput" rows="6" placeholder="مثال:
إعداد تقرير شهري عن أداء الإدارات
مراجعة السياسات وتحديثها وفق الدليل التنظيمي"></textarea>

  <div class="actions">
    <button id="analyzeBtn" type="button">تحليل المهام</button>
    <button id="clearBtn" class="secondary" type="button">مسح الإدخال</button>
    <button id="copyBtn" class="secondary" type="button">نسخ المخرجات</button>
  </div>

  <div class="result" id="output" aria-live="polite"></div>

  <!-- سكربتاتك -->
  script.js</script>

  <!-- ربط الأزرار بالدوال الموجودة في script.js -->
  <script>
    const analyzeBtn = document.getElementById('analyzeBtn');
    const clearBtn   = document.getElementById('clearBtn');
    const copyBtn    = document.getElementById('copyBtn');
    const inputEl    = document.getElementById('taskInput');
    const outputEl   = document.getElementById('output');

    // اربطي الزر بالدالة الموجودة لديك: analyzeTask()
    analyzeBtn.addEventListener('click', () => {
      try {
        analyzeBtn.disabled = true;
        analyzeBtn.textContent = 'جاري التحليل...';
        // تستدعي الدالة الموجودة التي أرسلتِها
        window.analyzeTask();
      } finally {
        analyzeBtn.disabled = false;
        analyzeBtn.textContent = 'تحليل المهام';
      }
    });

    clearBtn.addEventListener('click', () => {
      inputEl.value = '';
      outputEl.innerHTML = '';
      inputEl.focus();
    });

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(outputEl.innerText || '');
        copyBtn.textContent = 'تم النسخ ✓';
      } catch {
        copyBtn.textContent = 'تعذّر النسخ';
      } finally {
        setTimeout(()=> copyBtn.textContent='نسخ المخرجات', 1000);
      }
    });

    // تحسين اختياري: اجعلي applySuggestion تُحدث النص فعليًا
    // سيبحث عن المهمة رقم N في الإدخال ويستبدلها بالصياغة المقترحة
    window.applySuggestion = (taskIndex, suggestionIndex) => {
      // التقط الصياغة من صندوق الاقتراح المضغوط بجانب الزر
      const allSuggestionBlocks = document.querySelectorAll('[data-suggestion-block]');
      const block = allSuggestionBlocks[taskIndex * 3 + suggestionIndex]; // 3 اقتراحات/مهمة حسب كودك
      if (!block) return alert('تعذر العثور على الصياغة.');

      const suggestedText = block.querySelector('[data-s-text]')?.innerText?.trim();
      if (!suggestedText) return alert('تعذر قراءة الصياغة.');

      const lines = inputEl.value.split(/\r?\n/);
      // استبدال سطر المهمة (بنفس الفهرس)
      lines[taskIndex] = suggestedText.replace(/\s*\.\s*$/, ''); // بدون النقطة النهائية
      inputEl.value = lines.join('\n');

      // أعيدي التحليل مباشرة
      window.analyzeTask();
    };
  </script>
</body>
</html>
